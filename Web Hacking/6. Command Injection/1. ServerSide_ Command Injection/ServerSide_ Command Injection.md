# Command Injection

## Command Injection

**Command Injection** : **이용자의 입력을 시스템 명령어로 실행**하게 하는 취약점

**파이썬으로 개발된 웹 애플리케이션**에서 입력한 임의 IP에 ping을 전송하고 싶다면

```python
os.system("ping [user-input]")
```

임의 파일을 읽고 싶다면

```python
os.system(“cat [user-input]”)
```

등의 형태로 **시스템 함수를 사용**할 수 있다.

시스템 함수는 **리눅스의 셸 프로그램에 명령어를 전달**하여 실행하는데, 셸 프로그램은 **다양한 메타 문자**를 지원함

###  ` `` ` - 명령어 치환

` `` ` 안에 들어있는 **명령어를 실행한 결과로 치환**

```bash
$ echo `echo theori`
theori
```
### `$()` - 명령어 치환

`$()` 안에 있는 **명령어를 실행한 결과로 치환**(단, ` `` ` 와 다르게 **중복 사용 가능**)  
-> 예 : **echo $(echo $(echo theori))**  

```bash
$ echo $(echo theori)
theori
```

### `&&` - 명령어 연속 실행

**한 줄에 여러 명령어를 실행** 하고 싶을 때 사용(단, **앞 명령어에서 에러가 없어야 뒷 명령어 실행**)  

예 : A && B

1. A : 정상, B : 정상  
-> A, B
2. A : 에러, B : 정상, 에러  
-> 실행 X
3. A : 정상, B : 에러  
-> A, 에러

```bash
$ echo hello && echo theori
hello
theori
```

### `||` - 명령어 연속 실행

**한 줄에 여러 명령어를 실행** 하고 싶을 때 사용(단, **앞 명령어에서 에러가 발생해야 뒷 명령어 실행**)  

예 : A || B

1. A : 정상, B : 정상, 에러  
-> A
2. A : 에러, B : 정상  
-> B
3. A : 에러, B : 에러  
-> 실행 X

```bash
$ cat / || echo theori
cat: /: Is a directory
theori
```
### `;` - 명령어 구분자

**한 줄에 여러 명령어를 실행** 하고 싶을 때 사용(**앞 명령어의 에러가 상관없이 뒷 명령어 실행**)  

예 : A ; B

1. A : 정상, B : 정상  
-> A, B
2. A : 에러, B : 정상  
-> B
3. A : 에러, B : 에러  
-> 실행 X
4. A : 정상, B : 에러  
-> A, 에러

```bash
$ echo hello ; echo theori
hello
theori
```

### `|` - 파이프

**앞 명령어의 결과**가 **뒷 명령어의 입력**으로 들어감

```bash
$ echo id | /bin/sh
uid=1001(theori) gid=1001(theori) groups=1001(theori)
```

다음과 같이 **명령어를 치환**`(`` , $())`하거나, **연속해서 실행**`(&&, ||, ;)`하거나, **파이프라인**`(|)` 등을 사용할 수 있습니다.

## Command Injection 실습(개정 이전 실습)

<img src="3.jpg">

이 코드는 URL 쿼리를 통해 전달되는 **ip 값을 ping 명령어의 인자로 전달** 하는 코드입니다.

여기서는 **id 명령어**를 실행해야 합니다.

<img src="4.jpg">

이렇게 그냥 id 를 입력하면, id를 명령어로 인지하지 못합니다.

즉, 다른 방식으로 id를 진짜 명령어로 해석하게 해야합니다.

<img src="5.jpg">

이런식으로 id 를 명령어로 해석하게 할 수 있습니다.

<img src="6.jpg">

위와 다르게 아까 배웠던 다른 메타문자를 이용해서 실습할 수 있습니다.  

## Command Injection 실습

 **추후에 추가**

# 마치며

## 마치며

-  **인젝션(Injection)**: **악의적인 데이터**를 프로그램에 입력하여 이를 **시스템 명령어, 코드, 데이터베이스 쿼리 등으로 실행**되게 하는 기법. 웹 애플리케이션을 대상으로 하는 인젝션 공격은 SQL Injection, command injection등이 있음.
-  **커맨드 인젝션(Command Injection)**: 인젝션의 종류 중 하나. **시스템 명령어에 대한 인젝션**을 의미함. 취약점이 발생하는 원인은 단순하지만, 매우 치명적인 공격으로 이어질 수 있음. 개발자는 이용자의 입력을 반드시 검사해야 하며, 되도록 `system` 관련 함수의 사용을 자제해야 함.
- **메타 문자(Meta Character)**: **특수한 의미를 가진 문자**. 예를 들어, 셸 프로그램에서 `;`를 사용하면 여러 개의 명령어를 순서대로 실행시킬 수 있음.

# 퀴즈

```python
@app.route('/ping')
def ping():
	ip = request.args.get('ip')
	return os.system(f'ping -c 3 "{ip}"')
```
1. 다음은 Command Injeciton이 발생하는 코드이다. 어떠한 입력값을 넣어야 "/flag" 파일을 읽을 수 있을까?  
<strong>답 : "; cat /fl*;"</strong>

2. 커맨드 인젝션(Command Injection)의 설명으로 올바른 것은?  
**답 : 인젝션의 종류 중 하나. 시스템 명령어에 대한 인젝션을 의미함. 취약점이 발생하는 원인은 단순하지만, 매우 치명적인 공격으로 이어질 수 있음. 개발자는 이용자의 입력을 반드시 검사해야 하며, 되도록 system 함수의 사용을 자제해야 함.**

3. 메타 문자와 그에 대한 설명이 올바르게 짝지어진 것을 모두 고르세요.  
**답 : ``: 명령어 치환, ;: 명령어 구분자**